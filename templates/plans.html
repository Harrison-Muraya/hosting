{% extends 'base.html' %}


{% block title %}Hosting Plans - HostPro{% endblock %}

{% block content %}
<div class="mb-12">
    <!-- Header Section -->
    <div class="text-center mb-12">
        <h1 class="text-5xl font-bold text-gray-900 mb-4">Choose Your Perfect Plan</h1>
        <p class="text-xl text-gray-600">Flexible hosting solutions for every need</p>
    </div>

    <!-- Billing Cycle Toggle -->
    <div class="flex justify-center mb-12">
        <div class="bg-white rounded-lg shadow-md p-2 inline-flex">
            <button onclick="changeBillingCycle('monthly')" id="monthlyBtn" 
                    class="px-6 py-3 rounded-lg font-semibold transition-all billing-btn active">
                Monthly
            </button>
            <button onclick="changeBillingCycle('quarterly')" id="quarterlyBtn" 
                    class="px-6 py-3 rounded-lg font-semibold transition-all billing-btn">
                Quarterly <span class="text-green-600 text-sm">(Save 10%)</span>
            </button>
            <button onclick="changeBillingCycle('annually')" id="annuallyBtn" 
                    class="px-6 py-3 rounded-lg font-semibold transition-all billing-btn">
                Annually <span class="text-green-600 text-sm">(Save 20%)</span>
            </button>
        </div>
    </div>

    <!-- Plans Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
        {% for plan in plans %}
        <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 plan-card" 
             data-plan-id="{{ plan.id }}"
             data-monthly="{{ plan.price_monthly }}"
             data-quarterly="{{ plan.price_quarterly|default:plan.price_monthly }}"
             data-annually="{{ plan.price_annually|default:plan.price_monthly }}">
            
            <!-- Plan Header -->
            <div class="{% if forloop.counter == 2 %}bg-gradient-to-r from-blue-600 to-indigo-600{% else %}bg-gradient-to-r from-gray-700 to-gray-800{% endif %} text-white p-6 text-center relative">
                {% if forloop.counter == 2 %}
                <div class="absolute top-2 right-2">
                    <span class="bg-yellow-400 text-gray-900 text-xs font-bold px-3 py-1 rounded-full">
                        POPULAR
                    </span>
                </div>
                {% endif %}
                <h3 class="text-2xl font-bold mb-2">{{ plan.name }}</h3>
                <div class="text-4xl font-bold mb-2">
                    $<span class="plan-price">{{ plan.price_monthly }}</span>
                </div>
                <p class="text-sm opacity-90">/month</p>
            </div>

            <!-- Plan Features -->
            <div class="p-6">
                <ul class="space-y-4 mb-6">
                    <li class="flex items-start">
                        <i class="fas fa-microchip text-blue-500 mr-3 mt-1"></i>
                        <span><strong>{{ plan.cpu_cores }}</strong> CPU Core{{ plan.cpu_cores|pluralize }}</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-memory text-blue-500 mr-3 mt-1"></i>
                        <span><strong>{{ plan.ram_display }}</strong> RAM</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-hdd text-blue-500 mr-3 mt-1"></i>
                        <span><strong>{{ plan.disk_gb }} GB</strong> SSD Storage</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-exchange-alt text-blue-500 mr-3 mt-1"></i>
                        <span><strong>{{ plan.bandwidth_gb }} GB</strong> Bandwidth</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-shield-alt text-blue-500 mr-3 mt-1"></i>
                        <span>DDoS Protection</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-server text-blue-500 mr-3 mt-1"></i>
                        <span>Full Root Access</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-clock text-blue-500 mr-3 mt-1"></i>
                        <span>24/7 Support</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-rocket text-blue-500 mr-3 mt-1"></i>
                        <span>Instant Setup</span>
                    </li>
                </ul>

                <p class="text-sm text-gray-600 mb-6">{{ plan.description }}</p>

                <button onclick="orderPlan({{ plan.id }}, '{{ plan.name }}')" 
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-md">
                    <i class="fas fa-cart-plus mr-2"></i> Order Now
                </button>
            </div>
        </div>
        {% empty %}
        <div class="col-span-4 text-center py-12">
            <i class="fas fa-inbox text-gray-400 text-6xl mb-4"></i>
            <p class="text-xl text-gray-600">No plans available at the moment.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Features Comparison Section -->
    <div class="bg-white rounded-xl shadow-lg p-8 mb-16">
        <h2 class="text-3xl font-bold text-center mb-8">Compare Plans</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Feature</th>
                        {% for plan in plans %}
                        <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">{{ plan.name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <tr>
                        <td class="px-6 py-4 font-medium">CPU Cores</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center">{{ plan.cpu_cores }}</td>
                        {% endfor %}
                    </tr>
                    <tr class="bg-gray-50">
                        <td class="px-6 py-4 font-medium">RAM</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center">{{ plan.ram_mb }} MB</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="px-6 py-4 font-medium">Storage</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center">{{ plan.disk_gb }} GB SSD</td>
                        {% endfor %}
                    </tr>
                    <tr class="bg-gray-50">
                        <td class="px-6 py-4 font-medium">Bandwidth</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center">{{ plan.bandwidth_gb }} GB</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="px-6 py-4 font-medium">DDoS Protection</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center"><i class="fas fa-check text-green-500"></i></td>
                        {% endfor %}
                    </tr>
                    <tr class="bg-gray-50">
                        <td class="px-6 py-4 font-medium">Root Access</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center"><i class="fas fa-check text-green-500"></i></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="px-6 py-4 font-medium">24/7 Support</td>
                        {% for plan in plans %}
                        <td class="px-6 py-4 text-center"><i class="fas fa-check text-green-500"></i></td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Why Choose Us -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
        <div class="bg-white rounded-xl shadow-lg p-8 text-center">
            <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-bolt text-blue-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Instant Deployment</h3>
            <p class="text-gray-600">Your VM is deployed automatically within 5 minutes of payment confirmation.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-8 text-center">
            <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-shield-alt text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Enterprise Security</h3>
            <p class="text-gray-600">Advanced DDoS protection, firewalls, and regular security updates included.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-8 text-center">
            <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-headset text-purple-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">24/7 Support</h3>
            <p class="text-gray-600">Our expert support team is always available to help you succeed.</p>
        </div>
    </div>
</div>

<!-- Order Modal -->
 {% include 'modals/orderModal.html' %}

<style>
    .billing-btn {
        color: #4B5563;
    }
    .billing-btn.active {
        background: linear-gradient(to right, #2563eb, #4f46e5);
        color: white;
    }
</style>


<script>

let currentBillingCycle = 'monthly';
let selectedPlan = null;

function changeBillingCycle(cycle) {
    currentBillingCycle = cycle;
    
    // Update button styles
    document.querySelectorAll('.billing-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(cycle + 'Btn').classList.add('active');
    
    // Update all plan prices
    document.querySelectorAll('.plan-card').forEach(card => {
        const priceEl = card.querySelector('.plan-price');
        const price = card.dataset[cycle];
        priceEl.textContent = price;
    });
}

function orderPlan(planId, planName) {
    {% if not user.is_authenticated %}
        window.location.href = '/auth/login/?next=/plans/';
        return;
    {% endif %}
    
    selectedPlan = planId;
    const card = document.querySelector(`[data-plan-id="${planId}"]`);
    
    document.getElementById('orderPlanId').value = planId;
    document.getElementById('modalPlanName').textContent = planName;
    document.getElementById('summaryPlanName').textContent = planName;
    
    // Set prices in modal
    document.getElementById('monthlyPrice').textContent = '$' + card.dataset.monthly;
    document.getElementById('quarterlyPrice').textContent = '$' + card.dataset.quarterly;
    document.getElementById('annuallyPrice').textContent = '$' + card.dataset.annually;
    document.getElementById('summaryTotal').textContent = '$' + card.dataset.monthly;
    
    document.getElementById('orderModal').classList.remove('hidden');
}

function closeOrderModal() {
    document.getElementById('orderModal').classList.add('hidden');
}

// Update summary when billing cycle changes
document.addEventListener('DOMContentLoaded', function() {
    const billingInputs = document.querySelectorAll('input[name="billing_cycle"]');
    billingInputs.forEach(input => {
        input.addEventListener('change', function() {
            const cycle = this.value;
            document.getElementById('summaryBillingCycle').textContent = 
                cycle.charAt(0).toUpperCase() + cycle.slice(1);
            
            const card = document.querySelector(`[data-plan-id="${selectedPlan}"]`);
            if (card) {
                const price = card.dataset[cycle];
                document.getElementById('summaryTotal').textContent = '$' + price;
            }
        });
    });
});

// Handle form submission
document.getElementById('orderForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const errorDiv = document.getElementById('orderError');
    const submitBtn = document.getElementById('orderSubmitBtn');
    
    errorDiv.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';
    
    const formData = {
        plan_id: document.getElementById('orderPlanId').value,
        billing_cycle: document.querySelector('input[name="billing_cycle"]:checked').value,
        domain: document.getElementById('domain').value
    };
    
    try {
        const response = await fetch('/api/services/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            credentials: 'same-origin',
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            // Success - redirect to payment page
            window.location.href = `/dashboard/invoices/?new_invoice=${data.invoice.id}`;
        } else {
            errorDiv.textContent = data.error || 'Failed to create service. Please try again.';
            errorDiv.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-credit-card mr-2"></i> Proceed to Payment';
        }
    } catch (error) {
        console.error('Error:', error);
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-credit-card mr-2"></i> Proceed to Payment';
    }
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>

{% endblock %}